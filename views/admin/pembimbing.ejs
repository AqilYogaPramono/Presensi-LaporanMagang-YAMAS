<%- include('../partialsAdmin/__messages.ejs') %>
<%- include('../partialsAdmin/__head.ejs', { title: 'Dashboard Admin' }) %>
<%- include('../partialsAdmin/__nav-side.ejs') %>

<style>
    /* Center semua isi sel tabel (horizontal + vertical) */
    .table th,
    .table td {
        text-align: center;
        vertical-align: middle;
        padding: 12px 8px;
    }

    .cell-no { width: 60px; }
    .cell-nama { min-width: 200px; }
    .cell-email { min-width: 250px; }
    .cell-status { width: 140px; }
    .cell-aksi { width: 200px; }

    .aksi-flex {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
    }

    .badge {
        font-size: 0.8rem;
        padding: 0.5em 1em;
        font-weight: 600;
        border-radius: 20px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .badge i { font-size: 1rem; }

    .badge-aktif { background-color: #28a745; color: white; }
    .badge-proses { background-color: #ffc107; color: #212529; }
    .badge-nonaktif { background-color: #dc3545; color: white; }

    .table th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
        color: #495057;
    }

    .btn-sm {
        font-size: 0.8rem;
        padding: 0.45rem 0.85rem;
    }

    .btn-sm i { font-size: 1rem; margin-right: 6px; }
</style>

<div class="col-lg-12 grid-margin stretch-card">
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="card-title mb-0">Daftar Peserta</h4>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th class="cell-no">No</th>
              <th class="cell-nama">Nama</th>
              <th class="cell-email">Email</th>
              <th class="cell-status">Status</th>
              <th class="cell-aksi">Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% for (let i = 0; i < (getAllPembimbing || []).length; i++) { %>
              <tr>
                <td class="cell-no"><%= i + 1 %></td>
                <td class="cell-nama"><%= getAllPembimbing[i].nama %></td>
                <td class="cell-email"><%= getAllPembimbing[i].email %></td>
                <td class="cell-status">
                  <% if (getAllPembimbing[i].status === 'Aktif') { %>
                    <span class="badge badge-aktif">
                      <i class="mdi mdi-check-circle"></i> Aktif
                    </span>
                  <% } else if (getAllPembimbing[i].status === 'Proses') { %>
                    <span class="badge badge-proses">
                      <i class="mdi mdi-clock-outline"></i> Proses
                    </span>
                  <% } else { %>
                    <span class="badge badge-nonaktif">
                      <i class="mdi mdi-close-circle"></i> Non-Aktif
                    </span>
                  <% } %>
                </td>
                <td class="cell-aksi">
                  <div class="aksi-flex">
                    <button class="btn btn-sm btn-outline-primary" data-toggle="modal" data-target="#modalStatus<%= getAllPembimbing[i].id %>">
                      <i class="mdi mdi-account-edit"></i> Status
                    </button>
                    <button class="btn btn-sm btn-outline-danger" data-toggle="modal" data-target="#modalDelete<%= getAllPembimbing[i].id %>">
                      <i class="mdi mdi-delete-outline"></i> Hapus
                    </button>
                  </div>

                  <!-- Modal Update Status -->
                  <div class="modal fade" id="modalStatus<%= getAllPembimbing[i].id %>" tabindex="-1" role="dialog" aria-labelledby="modalStatusLabel<%= getAllPembimbing[i].id %>" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <form action="/admin/pembimbing/update/<%= getAllPembimbing[i].id %>" method="POST">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalStatusLabel<%= getAllPembimbing[i].id %>">Update Status Peserta</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                          </div>
                          <div class="modal-body">
                            <div class="form-group">
                              <label for="status<%= getAllPembimbing[i].id %>">Status:</label>
                              <select class="form-control" id="status<%= getAllPembimbing[i].id %>" name="status" required>
                                <option value="Proses" <%= getAllPembimbing[i].status === 'Proses' ? 'selected' : '' %>>Proses</option>
                                <option value="Aktif" <%= getAllPembimbing[i].status === 'Aktif' ? 'selected' : '' %>>Aktif</option>
                                <option value="Non-Aktif" <%= getAllPembimbing[i].status === 'Non-Aktif' ? 'selected' : '' %>>Non-Aktif</option>
                              </select>
                            </div>
                          </div>
                          <div class="modal-footer text-right">
                            <button type="button" class="btn btn-light" data-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-primary">Update</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>

                  <!-- Modal Delete -->
                  <div class="modal fade" id="modalDelete<%= getAllPembimbing[i].id %>" tabindex="-1" role="dialog" aria-labelledby="modalDeleteLabel<%= getAllPembimbing[i].id %>" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <form action="/admin/pembimbing/delete/<%= getAllPembimbing[i].id %>" method="POST">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="modalDeleteLabel<%= getAllPembimbing[i].id %>">Konfirmasi Hapus</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                          </div>
                          <div class="modal-body">
                            Apakah Anda yakin ingin menghapus peserta "<%= getAllPembimbing[i].nama %>"?
                          </div>
                          <div class="modal-footer text-right">
                            <button type="button" class="btn btn-light" data-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-danger">Hapus</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>

                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<%- include('../partialsAdmin/__script') %>
